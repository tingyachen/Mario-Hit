<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>è¸©çƒé¾œ</title>
  <style>
    * {
      margin: 0;
      padding: 0;
    }

    body {
      overflow: hidden;
    }

    .score-text {
      position: absolute;
      top: 30px;
      font-weight: bold;
      font-size: 30px;
      display: inline-block;
    }

    .score-img {
      width: 90px;
      height: 90px;
    }

    #container {
      position: relative;
      width: 920px;
      margin: 0 auto;
    }

    #game-box {
      width: 100%;
      height: 700px;
      background-image: url(./img/bg.png);
      background-repeat: no-repeat;
      background-size: cover;
      /* cursor: url(æª”æ¡ˆè·¯å¾‘) æ»‘é¼ xåº§æ¨™ æ»‘é¼ yåº§æ¨™, auto */
      cursor: url(./img/mario.png), auto;
    }

    .game {
      margin-left: 195px;
      padding-top: 190px;
    }

    .hole {
      padding-left: 10px;
      text-align: center;
      width: 140px;
      height: 140px;
      background-image: url(./img/pipe.png);
      background-size: contain;
      background-repeat: no-repeat;
      background-position: 10px 88px;
    }

    table {
      border-collapse: separate;
      border-spacing: 25px 3px;
    }

    img {
      width: 80px;
      height: 100px;
    }

    .score-box {
      position: absolute;
      width: 200px;
      height: 200px;
      right: -320px;
      bottom: 50px;
    }

    .score-chart {
      position: absolute;
      width: 200px;
      height: 200px;
      right: -300px;
      bottom: 100px;
    }

    .dialog {
      width: 240px;
      height: 185px;
      margin-left: -21px;
    }

    .star {
      margin-left: 73px;
    }
    /* --------æŒ‰éˆ•---------*/
    .wrapper {
      position: relative;
      display: block;
      width: 150px;
      height: 50px;
      margin-top: 95px;
      margin-left: 400px;
      text-align: center;
      line-height: 50px;
      color: black;
      background-color: transparent;
      border: 1px solid black;
      transition: all 0.3s linear;
      cursor: pointer;
      text-decoration: none;
    }

    .button {
      position: relative;
      z-index: 1;
      font-family: Verdana, Tahoma, sans-serif;
      font-size: 20px;
    }

    .wrapper::before {
      content: "";
      position: absolute;
      display: block;
      width: 0%;
      height: 0%;
      background: rgb(64, 67, 85);
      transition: all 0.3s ease;
    }

    .wrapper:hover {
      color: white;
    }

    .wrapper:hover::before {
      width: 100%;
      height: 100%;
      opacity: 1;
    }

    
  </style>
</head>

<body>

  <div id="container">
    <img src="./img/score.gif" class="score-img">
    <p class="score-text">ç›®å‰åˆ†æ•¸ï¼š<span id="score">0</span></p>


    <div id="game-box">
      <table class="game">
        <tr>
          <td class="hole" id="hole7"></td>
          <td class="hole" id="hole8"></td>
          <td class="hole" id="hole9"></td>
        </tr>
        <tr>
          <td class="hole" id="hole4"></td>
          <td class="hole" id="hole5"></td>
          <td class="hole" id="hole6"></td>
        </tr>
        <tr>
          <td class="hole" id="hole1"></td>
          <td class="hole" id="hole2"></td>
          <td class="hole" id="hole3"></td>
        </tr>

      </table>
      <div class="wrapper">
        <p class="button" id="start">Start!</p>
      </div>

      <div class="score-box">
        <h3>Top score</h3>
        <br>
        ç©å®¶ï¼š<span id="highname">???</span>
        åˆ†æ•¸ï¼š<span id="highscore">0</span>
      </div>

      <div class="score-chart">
        <img src="./img/dialog.png" class="dialog">
        <br>
        <img src="./img/score2.gif" class="star">
      </div>
    </div>

    <script>
      const holes = document.getElementsByClassName('hole')
      const start = document.getElementById('start')
      const scoreText = document.getElementById('score')
      const highnameText = document.getElementById('highname')
      const highscoreText = document.getElementById('highscore')

      // æœ€é«˜åˆ†
      const high = {
        score: 0,
        name: '???'
      }
      // è¨ˆåˆ†
      let score = 0
      // è¨ˆæ™‚å™¨
      let timer = 0
      // éŸ³æ•ˆ
      const audio = new Audio()

      // è®€å–è³‡æ–™
      const storage = JSON.parse(localStorage.getItem('topPlayer'))
      // å¦‚æœæœ‰è³‡æ–™
      if (storage) {
        high.name = storage.name
        high.score = storage.score
        // ä¿®æ”¹æœ€é«˜åˆ†é¡¯ç¤ºæ–‡å­—
        highnameText.innerText = high.name
        highscoreText.innerText = high.score
      }

      start.onclick = () => {
        // åœç”¨é–‹å§‹æŒ‰éˆ•
        start.disabled = true
        // é‡è¨­åˆ†æ•¸
        score = 0
        scoreText.innerText = score
        // æ¯ç§’è®Šæ›ä¸€æ¬¡
        timer = setInterval(game, 1000)
        game()
        // åç§’å¾ŒéŠæˆ²çµæŸ
        setTimeout(end, 10 * 1000)
      }

      // æ¯ç§’è®Šæ›é¡è‰²
      const game = () => {
        // ç§»é™¤é¡è‰²
        for (const hole of holes) {
          hole.innerHTML = ""
        }
        // éš¨æ©ŸæŠ½ä¸‰å€‹è®Šæ›æˆç´…è‰²ï¼Œä¸è€ƒæ…®é‡è¤‡
        for (let i = 0; i < 3; i++) {
          holes[Math.round(Math.random() * (holes.length - 1))].innerHTML =
            '<img src="./img/turtle.png" width="80" height="100">'
        }
      }


      // ä¿®æ”¹é»æ“Šåœ–
      let tb = document.querySelector('table')

      let tds = document.getElementsByTagName('td')
      for (let i = 0; i < tds.length; i++) {
        tds[i].onmousedown = function () {
          tb.style.cursor = "url(./img/mario2.png), auto"
          audio.src = './audio/maro-jump-sound.mp3'
          audio.play()
        }

        tds[i].onmouseup = function () {
          tb.style.cursor = "url(./img/mario.png), auto"
        }
      }

      for (const hole of holes) {
        hole.onclick = () => {
          if (hole.innerHTML != "") {
            // è®Šç‚ºè—è‰²
            hole.innerHTML = '<img src="./img/turtle-die.png" width="80" height="100">'
            // åŠ åˆ†
            score++
            scoreText.innerHTML = score


          }
        }
      }

      // éŠæˆ²çµæŸ
      const end = () => {
        // åœæ­¢è®Šæ›é¡è‰²
        clearInterval(timer)
        // æŠŠé¡è‰²æ¸…æ‰
        for (const hole of holes) {
          hole.innerHTML = ""
        }

        // å•Ÿç”¨é–‹å§‹æŒ‰éˆ•
        start.disabled = false
        // è·³å‡ºè¨Šæ¯
        alert(`éŠæˆ²çµæŸï¼Œä½ å¾—åˆ° ${score} åˆ†`)
        // ç´€éŒ„æœ€é«˜åˆ†
        if (score > high.score) {
          audio.src = './audio/super-mario.mp3'
          audio.play()
          // è«‹ç©å®¶è¼¸å…¥åå­—
          const input = prompt('é…·~ä½ å¾—åˆ°äº†æœ€é«˜åˆ†ğŸ˜è«‹è¼¸å…¥åå­—')
          // ä¿®æ”¹æœ€é«˜åˆ†è®Šæ•¸è³‡æ–™
          high.score = score
          high.name = input || '???'
          // ä¿®æ”¹æœ€é«˜åˆ†é¡¯ç¤ºæ–‡å­—
          highnameText.innerText = high.name
          highscoreText.innerText = high.score
          // ä¿å­˜
          // localStorage.setItem(è³‡æ–™å, æ–‡å­—)
          // è®Šæ•¸è½‰æ–‡å­—ï¼šJSON.stringify(è®Šæ•¸)
          localStorage.setItem('topPlayer', JSON.stringify(high))
        }
      }
    </script>
  </div>
</body>

</html>